<section class="CScrollText">
  <div class="content">
    <h1 class="heading">
      <span class="heading-text clip" data-scroll-text>森岡 良介です。</span>
    </h1>
    <p class="content">
      <span class="text clip" data-scroll-text></span>
      <span class="text clip" data-scroll-text>こちらのデモは、</span>
      <span class="text clip" data-scroll-text>スクロール量に合わせて、</span>
      <span class="text clip" data-scroll-text>linear-gradientの値を変更しています。</span>
      <span class="text clip" data-scroll-text>するとこのようにテキストの色が変わる、</span>
      <span class="text clip" data-scroll-text>演出を実装できます。いろんな場面で使えそうです。</span>
      <span class="text clip" data-scroll-text>ぜひ、試してみてください。</span>
    </p>
  </div>
</section>

<style lang="scss">
  .CScrollText {
    height: 100vh;
    display: grid;
    place-content: center;
  }

  .heading {
    line-height: 50px;
    font-size: 24px;
    margin-bottom: 50px;

    &-text {
      display: block;
      width: max-content;
    }
  }

  .content {
    line-height: 36px;
  }

  .text {
    font-size: 16px;
    display: block;
    width: max-content;
  }

  .clip {
    color: transparent;
    -webkit-background-clip: text;
    background-clip: text;
  }
</style>

<script>
  class CScrollText {
    [x: string]: any;

    constructor() {
      this.scrollText = document.querySelectorAll("[data-scroll-text");
      this.init();
    }

    updateGradient() {
      this.scrollText.forEach((elm) => {
        const rect = elm.getBoundingClientRect();
        const windowHeight = window.innerHeight;

        const triggerPoint = windowHeight / 1;

        if (rect.top < triggerPoint && rect.bottom >= 0) {
          const progress = (triggerPoint - rect.top) / triggerPoint;
          const easedProgress = this.easeInOutCubic(progress);
          const ratio = easedProgress * 1000;
          elm.style.backgroundImage = `linear-gradient(90deg, rgb(68, 64, 63)  ${ratio}%, rgba(68, 64, 63, .3) 0%)`;
        }
      });
    }

    //イージング
    easeInOutCubic(progress) {
      return progress < 0.5 ? 4 * progress * progress * progress : 1 - Math.pow(-2 * progress + 2, 3) / 2;
    }

    init() {
      window.addEventListener("scroll", this.updateGradient.bind(this));
      this.updateGradient();
    }
  }

  new CScrollText();
</script>
